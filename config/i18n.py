"""
Internationalization (i18n) module.

Provides translation support for multiple languages.
"""

from typing import Dict

from .settings import CURRENT_LANGUAGE, SUPPORTED_LANGUAGES

# ─────────────────────────────────────────────────────────────────────────────
# Language Translations
# ─────────────────────────────────────────────────────────────────────────────

LANG: Dict[str, Dict[str, str]] = {
    "ru": {
        # ── General ──
        "title": "Сетевой монитор",
        "start": "Запуск сетевого монитора для {target}...",
        "stop": "Мониторинг остановлен.",
        "press": "Нажмите Ctrl+C для остановки.",
        "na": "N/A",
        "ms": "мс",
        "never": "Никогда",
        "just_now": "Только что",
        "ago": "назад",
        "ok": "OK",
        "slow": "Медленно",
        "failed": "Ошибка",
        "error": "Ошибка",
        "none_label": "Нет",
        # ── Time units ──
        "time_d": "д",
        "time_h": "ч",
        "time_m": "м",
        "time_s": "с",
        # ── Status ──
        "status_ok": "OK",
        "status_timeout": "Таймаут",
        "status_connected": "ПОДКЛЮЧЕНО",
        "status_disconnected": "НЕТ СВЯЗИ",
        "status_degraded": "ДЕГРАДАЦИЯ",
        "status_timeout_bar": "ТАЙМАУТ",
        "status_waiting": "ОЖИДАНИЕ",
        # ── Section headers ──
        "conn": "ПОДКЛЮЧЕНИЕ",
        "stats": "СТАТИСТИКА",
        "lat": "ЗАДЕРЖКА",
        "mon": "МОНИТОРИНГ",
        "alerts": "УВЕДОМЛЕНИЯ",
        "analysis": "АНАЛИЗ",
        "notifications": "УВЕДОМЛЕНИЯ",
        # ── Latency panel ──
        "current": "Текущий",
        "best": "Лучший",
        "average": "Средний",
        "peak": "Пиковый",
        "median": "Медиана",
        "jitter": "Джиттер",
        "jitter_trend": "Тренд джиттера",
        "jitter_now": "Текущий джиттер",
        "p95": "95-й %",
        "ping": "Пинг",
        "loss": "Потери",
        "uptime": "Время работы",
        "trends": "Тренды",
        "spread": "Разброс",
        "latency_chart": "Задержка (последние значения):",
        "no_data": "нет данных",
        "waiting": "ожидание...",
        # ── Stats panel ──
        "sent": "Отправлено",
        "ok_count": "OK",
        "lost": "Потеряно",
        "losses": "Потери",
        "success_rate": "Успех",
        "loss_30m": "Потери 30м",
        "consecutive": "Подряд потерь",
        "max_label": "Макс",
        # ── MTU / TTL ──
        "mtu": "MTU",
        "path_mtu": "Path MTU",
        "mtu_ok": "OK",
        "mtu_low": "Снижен",
        "mtu_fragmented": "Фрагментация",
        "mtu_status_label": "MTU статус",
        "mtu_issues_label": "MTU проблем",
        "checks_unit": "проверок",
        "ttl": "TTL",
        "hops": "Хопов",
        "hop_unit": "хоп",
        "hops_unit": "хопов",
        # ── Problem analysis ──
        "problem_analysis": "АНАЛИЗ ПРОБЛЕМ",
        "problem_type": "Тип проблемы",
        "problem_none": "Нет проблем",
        "problem_isp": "Проблема ISP",
        "problem_local": "Локальная сеть",
        "problem_dns": "Проблема DNS",
        "problem_mtu": "Проблема MTU",
        "problem_unknown": "Неизвестно",
        "prediction": "Прогноз",
        "prediction_stable": "Стабильно",
        "prediction_risk": "Риск проблем",
        "pattern": "Паттерн",
        "last_problem": "Последняя",
        # ── Route analysis ──
        "route_analysis": "АНАЛИЗ МАРШРУТА",
        "route_label": "Маршрут",
        "hops_count": "Хопов",
        "problematic_hop": "Проблемный хоп",
        "problematic_hop_short": "Пробл.хоп",
        "route_changed": "Маршрут изменен",
        "route_stable": "Маршрут стабилен",
        "hop_latency": "Задержка хопа",
        "avg_latency": "Средняя задержка",
        "avg_latency_short": "Ср.задержка",
        "changed_hops": "Изменено",
        "changes": "Изменения",
        # ── Hop monitoring ──
        "hop_health": "ЗДОРОВЬЕ ХОПОВ",
        "hop_discovering": "Обнаружение хопов...",
        "hop_none": "Нет данных",
        "hop_good": "OK",
        "hop_slow": "Медл.",
        "hop_down": "Недоступен",
        "hop_worst": "Худший",
        "hop_loss_label": "Потери",
        "hop_col_num": "#",
        "hop_col_min": "Мин",
        "hop_col_avg": "Ср",
        "hop_col_last": "Посл",
        "hop_col_delta": "Δ",
        "hop_col_jitter": "Джиттер",
        "hop_col_loss": "Потери",
        "hop_col_host": "Хост",
        "hop_col_loc": "Локация",
        "hop_col_asn": "Провайдер",
        # ── Monitoring panel ──
        "alerts_label": "Тревоги",
        "traceroute_running": "Идет...",
        "alerts_off": "ВЫКЛ",
        "no_alerts": "Нет уведомлений.",
        # ── Footer ──
        "footer": "Ctrl+C — остановка  │  Логи: {log_file}",
        "update_available": "Обновление доступно: {current} → {latest} — pipx upgrade network-pinger",
        # ── Version check ──
        "version_checking": "Проверка версии...",
        "version_check_failed": "Ошибка проверки версии",
        "version_up_to_date": "Актуальная версия",
        # ── Alert messages (monitor.py) ──
        "alert_ip_changed": "IP изменен: {old} -> {new}",
        "alert_high_loss": "Высокие потери (30м): {val:.1f}%",
        "alert_loss_normalized": "Потери нормализовались",
        "alert_high_avg_latency": "Высокая средняя задержка: {val:.1f}мс",
        "alert_latency_normalized": "Задержка нормализовалась",
        "alert_connection_lost": "Соединение потеряно ({n} подряд)",
        "alert_connection_restored": "Соединение восстановлено",
        "alert_high_jitter": "Высокий джиттер: {val:.1f}мс",
        "alert_jitter_normalized": "Джиттер нормализовался",
        # ── Smart alert messages ──
        "alert_high_latency": "Высокая задержка: {val:.1f}мс",
        "alert_packet_loss": "Потери пакетов: {val:.1f}%",
        # ── Memory alerts ──
        "alert_memory_exceeded_shutdown": "Лимит памяти превышен ({current}MB > {limit}MB), завершение работы",
        # ── Main app ──
        "uptime_label": "Время работы",
        "bg_stopped": "Все фоновые потоки остановлены.",
        # ── Single instance ──
        "err_another_instance_running": "Ошибка: другой экземпляр программы уже запущен.",
        "alert_second_instance_attempt": "[!] Попытка открыть второе окно в {time}",
        # ── Dependency check ──
        "err_missing_commands": "Ошибка: отсутствуют системные команды: {cmds}",
        "install_commands_hint": "Для установки системных команд:",
        "win_ping_hint": "  ping и tracert входят в стандартную установку Windows",
        "win_tracert_hint": "  Если traceroute отсутствует, установите пакет 'tracert' из репозитория",
        "err_missing_deps": "Ошибка: отсутствуют зависимости:",
        "install_deps_hint": "Для установки выполните:",
        # ── Traceroute service ──
        "traceroute_not_found": "Traceroute: команда не найдена",
        "traceroute_timeout": "Traceroute: таймаут",
        "traceroute_starting": "Traceroute: запуск...",
        "traceroute_saved": "Traceroute сохранен: {file}",
        "traceroute_save_failed": "Не удалось сохранить traceroute",
        "traceroute": "Трассировка",
        "dns": "DNS",
        "network": "Сеть",
        "ok_label": "OK",
    },
    "en": {
        # ── General ──
        "title": "Network Monitor",
        "start": "Starting network monitor for {target}...",
        "stop": "Monitoring stopped.",
        "press": "Press Ctrl+C to stop.",
        "na": "N/A",
        "ms": "ms",
        "never": "Never",
        "just_now": "Just now",
        "ago": "ago",
        "ok": "OK",
        "slow": "Slow",
        "failed": "Failed",
        "error": "Error",
        "none_label": "None",
        # ── Time units ──
        "time_d": "d",
        "time_h": "h",
        "time_m": "m",
        "time_s": "s",
        # ── Status ──
        "status_ok": "OK",
        "status_timeout": "Timeout",
        "status_connected": "CONNECTED",
        "status_disconnected": "DISCONNECTED",
        "status_degraded": "DEGRADED",
        "status_timeout_bar": "TIMEOUT",
        "status_waiting": "WAITING",
        # ── Section headers ──
        "conn": "CONNECTION",
        "stats": "STATISTICS",
        "lat": "LATENCY",
        "mon": "MONITORING",
        "alerts": "ALERTS",
        "analysis": "ANALYSIS",
        "notifications": "NOTIFICATIONS",
        # ── Latency panel ──
        "current": "Current",
        "best": "Best",
        "average": "Average",
        "peak": "Peak",
        "median": "Median",
        "jitter": "Jitter",
        "jitter_trend": "Jitter trend",
        "jitter_now": "Jitter now",
        "p95": "95th %",
        "ping": "Ping",
        "loss": "Loss",
        "uptime": "Uptime",
        "trends": "Trends",
        "spread": "Spread",
        "latency_chart": "Latency (recent values):",
        "no_data": "no data",
        "waiting": "waiting...",
        # ── Stats panel ──
        "sent": "Sent",
        "ok_count": "OK",
        "ok_label": "OK",
        "lost": "Lost",
        "losses": "Losses",
        "success_rate": "Success",
        "loss_30m": "Loss 30m",
        "consecutive": "Consecutive",
        "max_label": "Max",
        # ── MTU / TTL ──
        "mtu": "MTU",
        "path_mtu": "Path MTU",
        "mtu_ok": "OK",
        "mtu_low": "Reduced",
        "mtu_fragmented": "Fragmented",
        "mtu_status_label": "MTU status",
        "mtu_issues_label": "MTU issues",
        "checks_unit": "checks",
        "ttl": "TTL",
        "hops": "Hops",
        "hop_unit": "hop",
        "hops_unit": "hops",
        # ── Problem analysis ──
        "problem_analysis": "PROBLEM ANALYSIS",
        "problem_type": "Problem Type",
        "problem_none": "No Problems",
        "problem_isp": "ISP Issue",
        "problem_local": "Local Network",
        "problem_dns": "DNS Issue",
        "problem_mtu": "MTU Issue",
        "problem_unknown": "Unknown",
        "prediction": "Prediction",
        "prediction_stable": "Stable",
        "prediction_risk": "Risk of Problems",
        "pattern": "Pattern",
        "last_problem": "Last",
        # ── Route analysis ──
        "route_analysis": "ROUTE ANALYSIS",
        "route_label": "Route",
        "hops_count": "Hops",
        "problematic_hop": "Problematic Hop",
        "problematic_hop_short": "Probl. hop",
        "route_changed": "Route Changed",
        "route_stable": "Route Stable",
        "hop_latency": "Hop Latency",
        "avg_latency": "Avg Latency",
        "avg_latency_short": "Avg latency",
        "changed_hops": "Changed",
        "changes": "Changes",
        # ── Hop monitoring ──
        "hop_health": "HOP HEALTH",
        "hop_discovering": "Discovering hops...",
        "hop_none": "No data",
        "hop_good": "OK",
        "hop_slow": "Slow",
        "hop_down": "Down",
        "hop_worst": "Worst",
        "hop_loss_label": "Loss",
        "hop_col_num": "#",
        "hop_col_min": "Min",
        "hop_col_avg": "Avg",
        "hop_col_last": "Last",
        "hop_col_delta": "Δ",
        "hop_col_jitter": "Jitter",
        "hop_col_loss": "Loss",
        "hop_col_host": "Host",
        "hop_col_loc": "Location",
        "hop_col_asn": "ASN",
        # ── Monitoring panel ──
        "alerts_label": "Alerts",
        "traceroute_running": "Running...",
        "alerts_off": "OFF",
        "no_alerts": "No notifications.",
        # ── Footer ──
        "footer": "Ctrl+C — stop  |  Logs: {log_file}",
        "update_available": "Update available: {current} → {latest} — pipx upgrade network-pinger",
        # ── Version check ──
        "version_checking": "Checking version...",
        "version_check_failed": "Version check failed",
        "version_up_to_date": "Up to date",
        # ── Alert messages (monitor.py) ──
        "alert_ip_changed": "IP changed: {old} -> {new}",
        "alert_high_loss": "High packet loss (30m): {val:.1f}%",
        "alert_loss_normalized": "Packet loss normalized",
        "alert_high_avg_latency": "High avg latency: {val:.1f}ms",
        "alert_latency_normalized": "Latency normalized",
        "alert_connection_lost": "Connection lost ({n} consecutive)",
        "alert_connection_restored": "Connection restored",
        "alert_high_jitter": "High jitter: {val:.1f}ms",
        "alert_jitter_normalized": "Jitter normalized",
        # ── Smart alert messages ──
        "alert_high_latency": "High latency: {val:.1f}ms",
        "alert_packet_loss": "Packet loss: {val:.1f}%",
        "traceroute": "Traceroute",
        "dns": "DNS",
        "network": "Network",
        # ── Memory alerts ──
        "alert_memory_exceeded_shutdown": "Memory limit exceeded ({current}MB > {limit}MB), shutting down",
        # ── Main app ──
        "uptime_label": "Uptime",
        "bg_stopped": "All background threads stopped.",
        # ── Single instance ──
        "err_another_instance_running": "Error: another instance is already running.",
        "alert_second_instance_attempt": "[!] Attempt to open second window at {time}",
        # ── Dependency check ──
        "err_missing_commands": "Error: missing system commands: {cmds}",
        "install_commands_hint": "To install system commands:",
        "win_ping_hint": "  ping and tracert are included in standard Windows installation",
        "win_tracert_hint": "  If traceroute is missing, install the 'tracert' package",
        "err_missing_deps": "Error: missing dependencies:",
        "install_deps_hint": "To install, run:",
        # ── Traceroute service ──
        "traceroute_not_found": "Traceroute: command not found",
        "traceroute_timeout": "Traceroute: timeout",
        "traceroute_starting": "Traceroute: starting...",
        "traceroute_saved": "Traceroute saved: {file}",
        "traceroute_save_failed": "Failed to save traceroute",
    },
}


def t(key: str) -> str:
    """Get translation for key in current language."""
    return LANG.get(CURRENT_LANGUAGE, LANG["ru"]).get(key, key)
